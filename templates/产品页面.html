{% extends 'base.html' %}
{% load static %}
{% block headjs %}
    <script src="{% static 'js/jquery.tips.js' %}"></script>
    <script src="{% static 'js/jquery.validator.js' %}"></script>
    <script src="{% static 'js/zh_CN.js' %}"></script>
    <script src="{% static 'js/jquery.jcarousellite.min.js' %}"></script>
{% endblock %}
{% block content %}
    <!--内页大图开始-->
    <div class="nybanner" aos="fade-up" aos-easing="ease" aos-duration="700">

        <img src="{{ MEDIA_URL }}{{ companyinfo.topimg }}" alt="{{ companyinfo.name }}"/></div>
    <!--内页大图结束-->
    <div class="submian">
        <div class="w1200 clearfix">
            <div class="sobtitle"><s class="ico"></s>您的位置：<a href="{% url 'index' %}" title="首页">首页</a> > <a
                    href="javascript:;"
                    title="产品中心">产品中心</a>
            </div>

            <div class="subleft fl">
                <!--栏目分类开始-->
                <div class="lefta bor9">
                    <div class="title"><h2>产品中心</h2></div>
                    <div class="comt">
                        <ul>
                            {% for product_cat in product_cats %}
                                <li class="{% ifequal request.GET.category product_cat.id|slugify %}hover{% endifequal %}">
                                    <a
                                            href="{% url 'products' %}?category={{ product_cat.id }}"
                                            title="{{ product_cat.name }}">{{ product_cat.name }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <!--栏目分类结束-->

                <!--推荐产品开始-->
                <div class="leftnews bor9">
                    <div class="title"><i>推荐产品</i></div>
                    <div class="leftprocomt clearfix">
                        <ul>
                            {% for left_product in left_products %}
                                {% if forloop.counter|divisibleby:"2" %}
                                    <li style="margin-right: 0;"><a href="javascript:;" title="{{ left_product.name }}"><img
                                            src="{{ MEDIA_URL }}{{ left_product.img }}" alt="{{ left_product.name }}">
                                        <p>{{ left_product.name }}</p></a></li>
                                {% else %}
                                    <li><a href="javascript:;" title="{{ left_product.name }}"><img
                                            src="{{ MEDIA_URL }}{{ left_product.img }}" alt="{{ left_product.name }}">
                                        <p>{{ left_product.name }}</p></a></li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <!--推荐产品结束-->

                <!--联系我们开始-->
                <div class="leftnews bor9">
                    <div class="title"><i>联系我们</i></div>
                    <div class="leftcont">
                        <h2>{{ companyinfo.name }}</h2>
                        <span>
                            地址：{{ companyinfo.address }}<br>
                            电话：{{ companyinfo.telephone }}<br>
                        </span>
                        <p>咨询热线<i>{{ companyinfo.phone }}</i></p></div>
                </div>
                <!--联系我们结束-->
            </div>
            <div class="subright fr">
                <!--图片内容开始-->
                <div class="conBox">
                    <div class="ArticleTitle"><h1>{{ product.name }}</h1></div>
                    <div class="ArticleMessage"><span>发布时间：{{ product.add_time|date:'Y-m-d' }}</span><span>人气：<i
                            id="hits">{{ product.click_nums }}</i></span></div>
                    <!--组图开始-->
                    {% if product_pics %}
                        <div class="MainBg">
                            <div class="HS10"></div>
                            <div class="OriginalPicBorder">
                                <div id="OriginalPic">
                                    <div id="aPrev" class="CursorL" title="上一张"></div>
                                    <div id="aNext" class="CursorR" title="下一张"></div>
                                    {% for product_pic in product_pics %}
                                        <p class="Hidden"><span class="SliderPicBorder FlRight"><img
                                                src="{{ MEDIA_URL }}{{ product_pic.img }}" alt=""/></span><span
                                                class="Clearer"></span>
                                        </p>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="HS15"></div>
                            <div class="ThumbPicBorder">
                                <img src="{% static 'images/ArrowL.jpg' %}" id="btnPrev" class="FlLeft"/>
                                <div class="pic">
                                    <div class="jCarouselLite FlLeft">
                                        <ul id="ThumbPic">
                                            {% for product_pic in product_pics %}
                                                <li rel='{{ forloop.counter0 }}'><img
                                                        src="{{ MEDIA_URL }}{{ product_pic.img }}" alt=""/></li>
                                            {% endfor %}
                                        </ul>
                                        <div class="Clearer"></div>
                                    </div>
                                </div>
                                <img src="{% static 'images/ArrowR.jpg' %}" id="btnNext" class="FlLeft"/>
                                <div class="Clearer"></div>
                            </div>
                        </div>
                    {% endif %}
                    <!--组图结束-->
                    <script type="text/javascript">
                        //缩略图滚动事件
                        $(".jCarouselLite").jCarouselLite({
                            btnNext: "#btnNext",
                            btnPrev: "#btnPrev",
                            scroll: 1,
                            speed: 240,
                            circular: false,
                            visible: 5
                        });
                    </script>

                    <script type="text/javascript">
                        var currentImage;
                        var currentIndex = -1;

                        //显示大图(参数index从0开始计数)
                        function showImage(index) {

                            //更新当前图片页码
                            $(".CounterCurrent").html(index + 1);

                            //隐藏或显示向左向右鼠标手势
                            var len = $('#OriginalPic img').length;
                            if (index == len - 1) {
                                $("#aNext").hide();
                            } else {
                                $("#aNext").show();
                            }

                            if (index == 0) {
                                $("#aPrev").hide();
                            } else {
                                $("#aPrev").show();
                            }

                            //显示大图
                            if (index < $('#OriginalPic img').length) {
                                var indexImage = $('#OriginalPic p')[index];

                                //隐藏当前的图
                                if (currentImage) {
                                    if (currentImage != indexImage) {
                                        $(currentImage).css('z-index', 2);
                                        $(currentImage).fadeOut(0, function () {
                                            $(this).css({'display': 'none', 'z-index': 1})
                                        });
                                    }
                                }

                                //显示用户选择的图
                                $(indexImage).show().css({'opacity': 0.4});
                                $(indexImage).animate({opacity: 1}, {duration: 200});

                                //更新变量
                                currentImage = indexImage;
                                currentIndex = index;

                                //移除并添加高亮
                                $('#ThumbPic img').removeClass('active');
                                $($('#ThumbPic img')[index]).addClass('active');

                                //设置向左向右鼠标手势区域的高度
                                //var tempHeight = $($('#OriginalPic img')[index]).height();
                                //$('#aPrev').height(tempHeight);
                                //$('#aNext').height(tempHeight);
                            }
                        }

                        //下一张
                        function ShowNext() {
                            var len = $('#OriginalPic img').length;
                            var next = currentIndex < (len - 1) ? currentIndex + 1 : 0;
                            showImage(next);
                        }

                        //上一张
                        function ShowPrep() {
                            var len = $('#OriginalPic img').length;
                            var next = currentIndex == 0 ? (len - 1) : currentIndex - 1;
                            showImage(next);
                        }

                        //下一张事件
                        $("#aNext").click(function () {
                            ShowNext();
                            if ($(".active").position().left >= 144 * 5) {
                                $("#btnNext").click();
                            }
                        });

                        //上一张事件
                        $("#aPrev").click(function () {
                            ShowPrep();
                            if ($(".active").position().left <= 144 * 5) {
                                $("#btnPrev").click();
                            }
                        });

                        //初始化事件
                        $(".OriginalPicBorder").ready(function () {
                            ShowNext();

                            //绑定缩略图点击事件
                            $('#ThumbPic li').bind('click', function (e) {
                                var count = $(this).attr('rel');
                                showImage(parseInt(count) - 0);
                            });
                        });
                    </script>
                    <div id="article" class="ArticleTencont"><p>
                        {{ product.info|safe }}</p>
                    </div>
                    <!--标签开始-->
                    <div class="tags"><span>标签：</span>
                        {% for tag in product.tag.all %}
                            <a href="javascript:;">{{ tag.name }}</a>
                        {% endfor %}
                    </div>
                    <!--标签结束-->
                    <!--统计代码开始-->
                    <div class="bshare-custom icon-medium">
                        <span>分享到：</span>
                        <a title="分享到QQ空间" class="bshare-qzone"></a>
                        <a title="分享到新浪微博" class="bshare-sinaminiblog"></a>
                        <a title="分享到人人网" class="bshare-renren"></a>
                        <a title="分享到腾讯微博" class="bshare-qqmb"></a>
                        <a title="分享到网易微博" class="bshare-neteasemb"></a>
                        <a title="更多平台" class="bshare-more bshare-more-icon more-style-addthis"></a>
                        <span class="BSHARE_COUNT bshare-share-count">0</span></div>
                    <script type="text/javascript" charset="utf-8"
                            src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=&amp;pophcol=2&amp;lang=zh"></script>
                    <script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
                    <!--统计代码结束-->
                    <div class="clear"></div>
                    <div class="reLink clearfix">
                        <div class="prevLink">上一篇：
                            {% if pre_product %}
                                <a title="{{ pre_product.name }}"
                                   href="{% url 'product_detail' pre_product.id %}?category={{ request.GET.category }}&keywords={{ request.GET.keywords }}">{{ pre_product.name }}</a>
                            {% else %}
                                <a title="暂无数据">暂无数据</a>
                            {% endif %}
                        </div>
                        <div class="nextLink">下一篇：
                            {% if next_product %}
                                <a title="{{ next_product.name }}"
                                   href="{% url 'product_detail' next_product.id %}?category={{ request.GET.category }}&keywords={{ request.GET.keywords }}">{{ next_product.name }}</a>
                            {% else %}
                                <a title="暂无数据">暂无数据</a>
                            {% endif %}
                        </div>
                    </div>
                    <!--评论开始-->
                    <div class="comment-main">
                        <div class="comment-title"><span>网友评论</span></div>
                        <div class="comment-show-box">
                            <!--评论列表开始-->
                            <div class="pl-box2">
                                <div class="item">
                                    <div class="c-commentAjax">
                                        {% for comment in comments %}
                                            <dl class="c-ajax">
                                                <dt><img src="{% static 'images/normal.png' %}"></dt>
                                                <dd><h1>匿名网友<span>{{ comment.add_time|date:'Y-m-d' }}</span></h1>
                                                    <p>评论内容测试</p>
                                                    <p class="xz-fc1">管理员回复：{{ comment.reply }}</p></dd>
                                            </dl>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="xz-cb"></div>
                            </div>
                            <!--评论列表结束-->
                            <!--评论表单开始-->
                            <form id="myform" class="form_comment">
                                <div class="fb-box">
                                    <dl>
                                        <dt><img src="{% static 'images/normal.png' %}"></dt>
                                        <dd><p><textarea type="text" name="content" placeholder="我也说两句"
                                                         data-rule="评论内容:required;" required></textarea></p>
                                            <input type="hidden" name="t1" value="匿名网友"></dd>
                                    </dl>
                                    <div class="xz-cb"></div>
                                </div>
                                <div class="fb-box-div">
                                    <dl>
                                        <dd>匿名网友</dd>
                                        <input type="submit" value="发表评论" name="send"></dl>
                                    <div class="xz-cb"></div>
                                </div>
                                {% csrf_token %}
                            </form>
                            <script>
                                $("#myform").submit(function () {
                                    $.ajax({
                                        cache: false,
                                        type: "POST",
                                        url: "{% url 'product_detail' product.id %}",
                                        data: $('#myform').serialize(),
                                        async: true,
                                        success:
                                            function (data) {
                                                if (data.status == 'success') {
                                                    alert("提交成功，等待管理员审核！");
                                                    location.reload();
                                                } else if (data.status == 'failed') {
                                                    alert("提交失败，请修改信息后，重新提交！");
                                                }
                                            }
                                    });
                                    return false   // 防止路由转向，即不刷新页面
                                })
                            </script>
                            <!--评论表单结束-->
                        </div>
                    </div>
                    <!--评论结束-->

                    <!--推荐资讯开始-->
                    <h4 class="anlitopH4"><span>推荐资讯</span></h4>
                    <div class="divremmnews">
                        <ul class="clearfix">
                            {% for foot_new in foot_news %}
                                <li><span class="fr">{{ foot_new.add_time|date:'Y-m-d' }}</span>
                                    <a href="{% url 'news_detail' foot_new.id %}" title="{{ foot_new.title }}">
                                        {% if foot_new.title|length > 22 %}
                                            {{ foot_new.title|slice:':22' }}...
                                        {% else %}
                                            {{ foot_new.title }}
                                        {% endif %}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <!--推荐资讯结束-->
                </div>
                <!--图片内容结束-->
            </div>
        </div>
    </div>
{% endblock %}